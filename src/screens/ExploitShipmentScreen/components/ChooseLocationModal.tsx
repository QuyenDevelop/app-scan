import { Header } from "@components";
import { ScreenUtils } from "@helpers";
import { useShipmentInfo } from "@hooks";
import { LocationResponse } from "@models";
import { IRootState } from "@redux";
import { Icon, Text, translate } from "@shared";
import { Metrics, Themes } from "@themes";
import React, { FunctionComponent, useState } from "react";
import {
  FlatList,
  Modal,
  TextInput,
  TouchableOpacity,
  View,
} from "react-native";
import { useSelector } from "react-redux";
import styles from "../styles";

interface Props {
  isVisible: boolean;
  closeModal: () => void;
  // customer: CustomerResponse | undefined;
  onSelectLocation: (location: LocationResponse) => void;
}

export const ChooseLocationModal: FunctionComponent<Props> = props => {
  useShipmentInfo();
  const { isVisible, closeModal, onSelectLocation } = props;
  const [searchValue, setSearchValue] = useState<string>("");
  const locationData = useSelector(
    (state: IRootState) => state.shipmentInfo.shipmentLocations,
  ) as Array<LocationResponse>;

  const [locations, setLocations] =
    useState<Array<LocationResponse>>(locationData);

  const onChangeSearchValue = (value: string) => {
    if (!value) {
      setSearchValue("");
      setLocations(locationData);
      return;
    }
    setSearchValue(value);
    const newData = locationData.filter(location => {
      const itemData = location.Name
        ? location.Name.toUpperCase()
        : "".toUpperCase();
      const textSearch = value.toUpperCase();
      return itemData.indexOf(textSearch) > -1;
    });
    setLocations(newData);
  };

  const customerKeyExtractor = (item: LocationResponse) => item.Id;
  const renderItem = ({ item }: { item: LocationResponse }) => {
    // const isSelected = item.Id === customer?.Id;
    const selectLocation = () => {
      onSelectLocation(item);
      closeModal();
      setSearchValue("");
    };
    return (
      <TouchableOpacity onPress={selectLocation}>
        <View style={styles.serviceSelect}>
          <Icon
            name="ic_location_1"
            size={Metrics.icons.small}
            color={Themes.colors.brand60}
          />
          <Text style={{ marginLeft: ScreenUtils.scale(8) }}>{item.Name}</Text>
        </View>
      </TouchableOpacity>
    );
  };

  return (
    <Modal
      visible={isVisible}
      animationType="slide"
      statusBarTranslucent={true}
    >
      <View style={styles.container}>
        <Header
          title={translate("label.location")}
          iconLeftName={["ic_arrow_left"]}
          iconLeftOnPress={[closeModal]}
          isCenterTitle
          iconLeftColor={[Themes.colors.coolGray100]}
          style={{ backgroundColor: Themes.colors.white }}
        />
        <View style={styles.content}>
          <View style={styles.searchView}>
            <Icon
              name="ic_search"
              size={Metrics.icons.smallSmall}
              color={Themes.colors.coolGray60}
            />
            <TextInput
              placeholder={translate("placeholder.enterCustomer")}
              style={styles.searchInput}
              value={searchValue}
              onChangeText={value => onChangeSearchValue(value)}
            />
          </View>
          <FlatList
            data={locations}
            keyExtractor={customerKeyExtractor}
            renderItem={renderItem}
            style={styles.bottomModal}
            showsVerticalScrollIndicator={false}
            keyboardShouldPersistTaps="handled"
            keyboardDismissMode="on-drag"
          />
        </View>
      </View>
    </Modal>
  );
};
