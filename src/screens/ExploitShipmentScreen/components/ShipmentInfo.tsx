import { ScreenUtils } from "@helpers";
import { useShow } from "@hooks";
import { LocationResponse, SubShipment } from "@models";
import { Icon, Text, translate } from "@shared";
import { Metrics, Themes } from "@themes";
import React, { FunctionComponent } from "react";
import {
  Keyboard,
  TextInput,
  TouchableOpacity,
  TouchableWithoutFeedback,
  View,
} from "react-native";
import { LocationModal } from "../../Scan/components/LocationModal";
import styles from "../styles";

export interface Props {
  subShipment: SubShipment;
  updateSubShipment: (shipment: SubShipment, index: 0) => void;
}

export const ShipmentInfo: FunctionComponent<Props> = (props: Props) => {
  const { subShipment, updateSubShipment } = props;
  const [isShowLocationModal, showLocationModal, hideLocationModal] = useShow();

  const updateWeight = (value: string) => {
    const newWeight = (parseFloat(value) || 0) / 1000;
    updateSubShipment({ ...subShipment, TotalGrossWeight: newWeight }, 0);
  };
  const updateLength = (value: string) => {
    const newLength = parseFloat(value) || 0;
    updateSubShipment({ ...subShipment, Length: newLength }, 0);
  };
  const updateWidth = (value: string) => {
    const newWidth = parseFloat(value) || 0;
    updateSubShipment({ ...subShipment, Width: newWidth }, 0);
  };
  const updateHeight = (value: string) => {
    const newHeight = parseFloat(value) || 0;
    updateSubShipment({ ...subShipment, Height: newHeight }, 0);
  };
  const onSelectLocation = (location: LocationResponse) => {
    updateSubShipment({ ...subShipment, LocationName: location.Name }, 0);
  };

  return (
    <TouchableWithoutFeedback onPress={Keyboard.dismiss}>
      <View style={styles.subShipmentContainer}>
        <View style={styles.generalInfoRow}>
          <Text style={styles.labelInfo}>{translate("label.location")}</Text>
          <TouchableOpacity
            style={styles.locationButton}
            hitSlop={styles.hitSlop}
            onPress={showLocationModal}
          >
            <>
              <Text
                style={[
                  styles.labelInfo,
                  { marginRight: ScreenUtils.scale(8) },
                ]}
              >
                {subShipment.LocationName || translate("label.location")}
              </Text>
              <Icon
                name="ic_arrow_down"
                size={Metrics.icons.smallSmall}
                color={Themes.colors.coolGray100}
              />
            </>
          </TouchableOpacity>
        </View>
        <View style={styles.generalInfoRow}>
          <Text style={styles.labelInfo}>
            {translate("label.subShipmentWeight")}
          </Text>
          <View style={styles.rowEnd}>
            <TextInput
              placeholder={translate("placeholder.enterWeight")}
              style={[styles.inputInfo, { color: Themes.colors.coolGray60 }]}
              keyboardType="number-pad"
              contextMenuHidden={true}
              placeholderTextColor={Themes.colors.collGray40}
              value={((subShipment.TotalGrossWeight || 0) * 1000).toString()}
              onChangeText={updateWeight}
            />
            <Text style={styles.contentInfo}>{translate("label.gram")}</Text>
          </View>
        </View>
        <View style={styles.boxShipmentIfo}>
          <View style={styles.spaceBetween}>
            <Text style={styles.labelInfo}>
              {translate("label.dimension")} ({translate("placeholder.length")}{" "}
              x {translate("placeholder.width")} x{" "}
              {translate("placeholder.height")})
            </Text>
            <Text style={styles.contentInfo}>{translate("label.cm")}</Text>
          </View>
          <View
            style={[
              styles.generalInfoRow,
              { borderBottomWidth: ScreenUtils.scale(0) },
            ]}
          >
            <TextInput
              placeholder={translate("placeholder.length")}
              style={[styles.inputInfo, { color: Themes.colors.coolGray60 }]}
              keyboardType="number-pad"
              contextMenuHidden={true}
              placeholderTextColor={Themes.colors.collGray40}
              value={subShipment.Length?.toString() || "0"}
              onChangeText={updateLength}
            />
            <TextInput
              placeholder={translate("placeholder.width")}
              style={[styles.inputInfo, { color: Themes.colors.coolGray60 }]}
              keyboardType="number-pad"
              contextMenuHidden={true}
              placeholderTextColor={Themes.colors.collGray40}
              value={subShipment.Width?.toString() || "0"}
              onChangeText={updateWidth}
            />
            <TextInput
              placeholder={translate("placeholder.height")}
              style={[styles.inputInfo, { color: Themes.colors.coolGray60 }]}
              keyboardType="number-pad"
              contextMenuHidden={true}
              placeholderTextColor={Themes.colors.collGray40}
              value={subShipment.Height?.toString() || "0"}
              onChangeText={updateHeight}
            />
          </View>
        </View>

        <LocationModal
          isShowModal={isShowLocationModal}
          closeModal={hideLocationModal}
          onSelectLocation={onSelectLocation}
        />
      </View>
    </TouchableWithoutFeedback>
  );
};
